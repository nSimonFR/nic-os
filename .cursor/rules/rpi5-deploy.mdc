---
description: Auto-deploy RPi5 NixOS + Home Manager configuration via SSH after changes
globs: rpi5/**/*.nix, home/**/*.nix
alwaysApply: false
---

# RPi5 Deployment

After making changes to RPi5 or shared home configuration files, apply them over SSH.

**Important:** Always use `path:` prefix (e.g. `path:.#rpi5`) instead of bare `.#rpi5` so that Nix reads all files from disk directly. This avoids the need to `git add` new files before building.

## Deploy (system + home-manager in one step)

Home Manager is integrated as a NixOS module, so a single command deploys everything:

```sh
nixos-rebuild switch --flake path:.#rpi5 --target-host nsimon@rpi5.local --use-remote-sudo
```

Run from the repo root (`/home/nsimon/nic-os`).

If the build fails, read the error output and fix the Nix configuration before retrying.
