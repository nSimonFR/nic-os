---
description: Auto-deploy RPi5 NixOS + Home Manager configuration via SSH after changes
globs: rpi5/**/*.nix, home/**/*.nix
alwaysApply: false
---

# RPi5 Deployment

After making changes to RPi5 or shared home configuration files, apply them over SSH.

`nixos-rebuild` is **not available on macOS**. The correct workflow is to rsync changed files to the rpi5, then run the rebuild remotely over SSH.

**Important:** Always use `path:` prefix so Nix reads files from disk without requiring `git add`.

## Deploy (system + home-manager in one step)

```sh
# 1. Sync changed files (adjust path as needed for what changed)
rsync -av /Users/nsimon/nic-os/rpi5/ nsimon@rpi5:~/nic-os/rpi5/

# 2. Build and switch on the rpi5
ssh nsimon@rpi5 "cd ~/nic-os && sudo nixos-rebuild switch --flake path:.#rpi5 2>&1"
```

If only specific files changed, sync just those files instead of the whole directory to save time:

```sh
rsync -av /Users/nsimon/nic-os/rpi5/some-file.nix nsimon@rpi5:~/nic-os/rpi5/some-file.nix
```

If the build fails, read the error output and fix the Nix configuration before retrying.
